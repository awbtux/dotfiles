#!/bin/sh

# script to deploy the current dotfiles
# if the login shell doesn't find .local/share/dots/.configured.txt, this runs automatically
# TODO: finish this script

# we need these
command -v generate-theme >/dev/null 2>&1 && generate-theme

# run the wizard to generate a git configuration file if none is present
test ! -r "${GIT_CONFIG_GLOBAL:-$HOME/.gitconfig}" && command -v git-wizard >/dev/null 2>&1 && git-wizard

# if $HOME is the worktree of a git repo, pull from origin and init submodules
test -d "$HOME/.git" && command -v git >/dev/null 2>&1 && {
    cd "$HOME"
    git pull
    git submodule update --init --recursive
    cd "$OLDPWD"
}

# prevent this script from getting automatically sourced by login scripts
printf "%s\n%s\n%s\n%s\n" \
    "This file was created by ~/.local/bin/scripts/deploy-dots when the script" \
    "finished, so the login script responsible for one-time setup knows there" \
    "isn't anything else \`deploy-dots\` needs to do. If you delete it, the session" \
    "will invoke \`deploy-dots\` next time you log in." \
>"${XDG_DATA_HOME:-$HOME/.local/share}/dots/.configured.txt"
