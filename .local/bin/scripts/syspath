#!/bin/sh

# selectively ignore user PATH entries to run system binaries

# load shell functions
[ -r "${XDG_CONFIG_HOME:-$HOME/.config}/shell/functions" ] && . "${XDG_CONFIG_HOME:-$HOME/.config}/shell/functions"

# add to path
pathadd() {
    case ":$PATH:" in
        *:"${1%/}":*) ;;
        *) [ -d "$1" ] && { [ "$2" = "-a" ] && export PATH="${PATH:+$PATH:}${1%/}" || export PATH="${1%/}${PATH:+:$PATH}"; } ;;
    esac
}

# initialize field separator
OLDIFS="$OLDIFS"
IFS=":"

# initialize path
OLDPATH="$PATH"
PATH=""

# discard path elements in the home directory (ex. this script)
for i in $OLDPATH; do
    case "$i" in *"$HOME"*) continue ;; esac; pathadd "$i"
done

# get old ifs
IFS="$OLDIFS"

# run the command
require-cmd "$1" || exit 127
cmd="$1"; shift
"$cmd" "$@"
